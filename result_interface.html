<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>电商评论分析系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 基础重置与全局样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            min-height: 100vh;
            background-color: #f5f7fa;
            padding: 20px;
            color: #333;
        }

        /* 顶部导航与Logo */
        .header-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 40px;
            background-color: rgb(239, 239, 239);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            z-index: 100;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .home-link-container {
            margin-left: 20px;
        }

        .home-link {
            text-decoration: none;
            color: #4e6ef2;
            font-weight: 500;
            font-size: 15px;
            padding: 6px 12px;
            border-radius: 18px;
            transition: all 0.2s;
        }

        .home-link:hover {
            background-color: #f0f4ff;
        }

        .company-logo {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            object-fit: cover;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
            color: #4e6ef2;
        }

        /* 搜索框样式 */
        .search-container {
            flex: 1;
            max-width: 450px;
            margin: 0 30px;
            position: relative;
        }

        .search-input {
            width: 100%;
            height: 40px;
            padding: 0 16px;
            border: 1px solid #8a2be2;
            border-radius: 20px;
            font-size: 15px;
            outline: none;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            border-color: #8a2be2;
        }

        .search-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #4e6ef2;
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .top-right-links {
            display: flex;
            gap: 20px;
        }

        .top-right-links a {
            text-decoration: none;
            color: #4e6ef2;
            font-weight: 500;
            font-size: 15px;
            padding: 6px 12px;
            border-radius: 18px;
            transition: all 0.2s;
        }

        .top-right-links a {
            position: relative;
        }

        .top-right-links a:hover {
            background-color: #f0f4ff;
        }

        /* 历史记录tooltip样式 */
        .history-container {
            position: relative;
        }

        #historyTooltip {
            position: absolute;
            top: 100%;
            right: 0;
            width: 250px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 10px;
            display: none;
            z-index: 1000;
        }

        #historyTooltip h4 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 14px;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        #historyTooltip ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #historyTooltip li {
            margin-bottom: 8px;
        }

        #historyTooltip li a {
            color: #333;
            text-decoration: none;
            padding: 5px 0;
            display: block;
            transition: color 0.2s;
        }

        #historyTooltip li a:hover {
            color: #3498db;
        }

        .no-history {
            color: #999;
            text-align: center;
            padding: 10px 0;
        }

        /* 主内容区 */
        .main-content {
            max-width: 1200px;
            margin: 90px auto 40px;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .appliance-section {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            padding: 25px;
        }

        .section-title {
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 28px;
            position: relative;
        }

        .section-title:after {
            content: "";
            display: block;
            width: 80px;
            height: 4px;
            background: #4e6ef2;
            margin: 12px auto;
            border-radius: 2px;
        }

        /* 家电展示区 */
        .appliance-display {
            display: flex;
            justify-content: center;
            margin: 15px 0 30px;
        }

        .appliance-image {
            width: 100%;
            max-width: 500px;
            height: 300px;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .appliance-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .appliance-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 12px;
            text-align: center;
            font-size: 20px;
            font-weight: 600;
        }

        /* 评论分析卡片 */
        .analytics-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            text-align: center;
            transition: transform 0.2s;
            border: 1px solid #f0f0f0;
        }

        .metric-card:hover {
            transform: translateY(-3px);
        }

        .metric-title {
            font-size: 18px;
            color: #666;
            margin-bottom: 15px;
        }

        .metric-value {
            font-size: 36px;
            font-weight: 700;
            color: #2c3e50;
            margin: 10px 0;
        }

        .metric-description {
            font-size: 14px;
            color: #888;
            margin-top: 10px;
        }

        /* 环形进度条 */
        .progress-ring {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 15px;
        }

        .ring-circle {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            font-weight: 700;
        }

        /* 评分星级 */
        .star-rating {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin: 15px 0;
        }

        .star-rating i {
            color: #f1c40f;
            font-size: 28px;
        }

        /* 总结栏 */
        .summary-section {
            background: #4e6ef2;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            color: white;
        }

        .summary-title {
            font-size: 20px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
        }

        .summary-content {
            font-size: 16px;
            line-height: 1.6;
            text-align: justify;
        }

        .summary-highlight {
            font-weight: 700;
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            margin: 0 2px;
        }

        .summary-negative {
            color: #ffeaa7;
            font-weight: 600;
        }

        /* 响应式调整 */
        @media (max-width: 1024px) {
            .appliance-image {
                max-width: 400px;
                height: 250px;
            }
        }

        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }

            .logo-container {
                flex-direction: column;
                gap: 8px;
            }

            .search-container {
                width: 100%;
                max-width: 100%;
                margin: 10px 0;
            }

            .appliance-image {
                max-width: 300px;
                height: 200px;
            }

            .main-content {
                margin-top: 170px;
            }

            .analytics-section {
                grid-template-columns: 1fr;
            }
        }

        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #4e6ef2;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <!-- 顶部导航 -->
    <div class="header-container">
        <!-- Logo容器 - 左侧添加了企业Logo和专业团队Logo -->
        <div class="logo-container">
            <!-- 企业Logo - 已更新为指定URL -->
            <img class="company-logo"
                src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/creation_agent/05433fecd0354b6abf69b01d84de2c43~tplv-a9rns2rl98-web-preview-watermark.png?rcl=20250804204841824A6265E6A6E7CA1F32&rk3s=8e244e95&rrcfp=5057214b&x-expires=2069671744&x-signature=rQr3oVDd%2B9oUt1%2BqX3XNyPsmwWw%3D"
                alt="企业Logo">

            <!-- 专业团队Logo -->
            <div class="team-logo">
                <div class="logo-text">专业团队</div>
            </div>
            <div class="home-link-container">
                <a href="start_interface.html" class="home-link">首页</a>
            </div>
            <div class="home-link-container">
                <a href="javascript:history.back()" class="home-link">返回上一级</a>
            </div>
        </div>

        <!-- 新增搜索框 -->
        <div class="search-container">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="搜索你感兴趣的产品吧">
                <svg class="search-icon" viewBox="0 0 24 24" fill="none">
                    <path
                        d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </div>
        </div>

        <!-- 右上角导航 -->
        <div class="top-right-links">
            <div class="history-container">
                <a href="history_interface.html" class="history-link"><i class="fas fa-history"></i> 历史记录</a>
                <div class="tooltip" id="historyTooltip"></div>
            </div>
        </div>
    </div>

    <!-- 主体内容 -->
    <div class="main-content">
        <!-- 家电展示区 -->
        <div class="appliance-section">
            <h2 class="section-title">产品分析</h2>
            <div class="appliance-display">
                <div class="appliance-image">
                    <img src="https://images.unsplash.com/photo-1550009158-9dcfbed1d89d?q=80&w=1000" alt="产品图片">
                    <div class="appliance-name">vivio S17e</div>
                </div>
            </div>

            <!-- 评论分析 -->
            <div class="analytics-section">
                <!-- 好评率 -->
                <div class="metric-card" id="positiveRateCard">
                    <div class="metric-title">好评率</div>
                    <div class="progress-ring">
                        <svg width="120" height="120">
                            <circle class="ring-circle" r="50" cx="60" cy="60" stroke="#e6e6e6" stroke-width="8"
                                fill="none"></circle>
                            <circle class="ring-circle" r="50" cx="60" cy="60" stroke="#2ecc71" stroke-width="8"
                                stroke-dasharray="314" stroke-dashoffset="62.8" stroke-linecap="round" fill="none">
                            </circle>
                        </svg>
                        <div class="progress-text" id="positiveRateValue">80%</div>
                    </div>
                    <div class="metric-description">用户满意度指标</div>
                </div>

                <!-- 总评论数 -->
                <div class="metric-card" id="totalReviewsCard">
                    <div class="metric-title">总评论数</div>
                    <div class="metric-value" id="totalReviewsValue">24,587</div>
                    <div class="metric-description">所有用户评论数量</div>
                </div>

                <!-- 平均评分 -->
                <div class="metric-card" id="averageRatingCard">
                    <div class="metric-title">平均评分</div>
                    <div class="star-rating" id="starRating">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>
                    </div>
                    <div class="metric-value" id="averageRatingValue">4.7</div>
                    <div class="metric-description">基于用户评分</div>
                </div>
            </div>

            <!-- 爬虫生成总结栏 -->
            <div class="summary-section" id="summarySection">
                <h3 class="summary-title">用户评论综合分析</h3>
                <p class="summary-content">
                    基于<span class="summary-highlight" id="totalReviewsSummary">24,587条</span>用户评论分析显示，用户对于该产品的<span
                        class="summary-highlight">游戏功能</span>给予了高度评价，<span
                        class="summary-highlight">85%</span>的用户认为运行效果突出。关于声音问题，<span
                        class="summary-highlight">15%</span>的用户反馈运行声音较好,音质好，其中<span
                        class="summary-negative">3%</span>的用户认为已影响到日常使用。智能功能中，<span
                        class="summary-highlight">App远程控制</span>的易用性获得最高满意度（92%），而<span
                        class="summary-negative">语音识别</span>的准确度（78%）仍有改进空间。
                </p>
            </div>
        </div>
    </div>

    <script src="history.js"></script>
    <script>
        // 历史记录悬停功能
        document.addEventListener('DOMContentLoaded', function() {
            const historyLink = document.querySelector('.history-link');
            const historyTooltip = document.getElementById('historyTooltip');

            // 生成历史记录HTML的函数
            function generateHistoryTooltipHTML() {
                if (!window.HistoryManager) return '<p class="no-history">无法加载历史记录</p>';

                const history = HistoryManager.getSearchHistory();
                if (history.length === 0) {
                    return '<p class="no-history">暂无搜索历史</p>';
                }

                let html = '<h4>最近搜索</h4><ul>';
                // 只显示最近的5条记录
                const recentHistory = history.slice(0, 5);
                recentHistory.forEach(item => {
                    html += `
                        <li>
                            <a href="result_interface.html?search=${encodeURIComponent(item.keyword)}">${item.keyword}</a>
                        </li>
                    `;
                });
                html += '</ul>';
                return html;
            }

            // 显示tooltip的函数
            function showTooltip() {
                historyTooltip.innerHTML = generateHistoryTooltipHTML();
                historyTooltip.style.display = 'block';
            }

            // 隐藏tooltip的函数
            function hideTooltip() {
                historyTooltip.style.display = 'none';
            }

            // 为历史记录链接添加事件监听
            if (historyLink && historyTooltip) {
                historyLink.addEventListener('mouseenter', function() {
                    // 立即显示tooltip，无需延迟
                    showTooltip();
                });

                historyLink.addEventListener('mouseleave', hideTooltip);

                // 确保当鼠标移到tooltip上时不会消失
                historyTooltip.addEventListener('mouseenter', function() {
                    this.style.display = 'block';
                });

                historyTooltip.addEventListener('mouseleave', hideTooltip);
            }
        });    
        // API模拟数据
        const mockData = {
            positiveRate: 80,
            totalReviews: 24587,
            averageRating: 4.7,
            summaryContent: "基于24,587条用户评论分析显示，用户对于该冰箱的冷藏功能给予了高度评价，85%的用户认为保鲜效果突出。关于噪音问题，15%的用户反馈运行声音较大，其中3%的用户认为已影响到日常使用。智能功能中，App远程控制的易用性获得最高满意度（92%），而语音识别的准确度（78%）仍有改进空间。"
        };

        // 模拟API调用
        async function fetchAnalyticsData() {
            // 模拟API延迟
            await new Promise(resolve => setTimeout(resolve, 800));

            return {
                status: "success",
                data: mockData
            };
        }

        // 更新环形进度条
        function updateProgressRing(percentage) {
            const circle = document.querySelector('circle:last-of-type');
            const radius = circle.r.baseVal.value;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (circumference * percentage) / 100;

            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = circumference;

            setTimeout(() => {
                circle.style.transition = 'stroke-dashoffset 1.5s ease-in-out';
                circle.style.strokeDashoffset = offset;
            }, 300);
        }

        // 更新星级评分
        function updateStarRating(rating) {
            const starContainer = document.getElementById('starRating');
            starContainer.innerHTML = '';

            const fullStars = Math.floor(rating);
            const hasHalfStar = (rating - fullStars) >= 0.5;

            // 添加完整星星
            for (let i = 0; i < fullStars; i++) {
                starContainer.innerHTML += '<i class="fas fa-star"></i>';
            }

            // 添加半星
            if (hasHalfStar) {
                starContainer.innerHTML += '<i class="fas fa-star-half-alt"></i>';
            }

            // 添加剩余空星
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            for (let i = 0; i < emptyStars; i++) {
                starContainer.innerHTML += '<i class="far fa-star"></i>';
            }
        }

        // 格式化大数字
        function formatNumber(number) {
            return new Intl.NumberFormat('en-US').format(number);
        }

        // 更新UI
        function updateAnalyticsUI(data) {
            // 更新好评率
            document.getElementById('positiveRateValue').textContent = `${data.positiveRate}%`;
            updateProgressRing(data.positiveRate);

            // 更新总评论数
            document.getElementById('totalReviewsValue').textContent = formatNumber(data.totalReviews);

            // 更新平均评分
            document.getElementById('averageRatingValue').textContent = data.averageRating;
            updateStarRating(data.averageRating);

            // 更新总结栏
            document.getElementById('summarySection').querySelector('.summary-content').textContent = data.summaryContent;

            // 更新总结栏中的引用数字
            document.getElementById('totalReviewsSummary').textContent = formatNumber(data.totalReviews) + '条';
        }

        // 搜索功能实现
        function setupSearch() {
            const searchIcon = document.querySelector('.search-icon');
            const searchInput = document.querySelector('.search-input');

            // 抽取搜索逻辑为单独函数
            function performSearch() {
                const keyword = searchInput.value.trim();

                if (keyword) {
                    // 保存搜索历史
                    if (window.HistoryManager) {
                        HistoryManager.addSearchHistory(keyword);
                    }
                    // 跳转到新的页面实例，并带上搜索参数
                    window.location.href = 'result_interface.html?search=' + encodeURIComponent(keyword) + '&redirect=true';
                } else {
                    alert('请输入搜索内容');
                }
            }

            // 点击搜索图标触发搜索
            searchIcon.addEventListener('click', performSearch);

            // 按下Enter键触发搜索
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault(); // 阻止默认行为
                    performSearch();
                }
            });

            // 额外添加keydown事件监听，确保兼容性
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault(); // 阻止默认行为
                    performSearch();
                }
            });
        }


        // 获取URL参数
        function getURLParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function () {
            // 设置搜索功能
            setupSearch();

            // 获取并显示搜索关键词
            const searchKeyword = getURLParameter('search');
            const isRedirect = getURLParameter('redirect') === 'true';
            if (searchKeyword) {
                // 如果是通过搜索跳转过来的，则添加到历史记录
                if (isRedirect && window.HistoryManager) {
                    HistoryManager.addSearchHistory(decodeURIComponent(searchKeyword));
                }
                // 更新页面标题
                document.querySelector('.section-title').textContent = `"${decodeURIComponent(searchKeyword)}" 分析结果`;
                // 更新电器名称
                document.querySelector('.appliance-name').textContent = decodeURIComponent(searchKeyword);
                // 更新总结部分
                const summaryContent = document.querySelector('.summary-content');
                const originalSummary = summaryContent.textContent;
                summaryContent.textContent = `基于搜索关键词 "${decodeURIComponent(searchKeyword)}" 的分析显示，${originalSummary.substring(originalSummary.indexOf('用户对于该冰箱的'))}`;
            }

            // 设置加载状态
            document.getElementById('positiveRateCard').classList.add('loading');
            document.getElementById('totalReviewsCard').classList.add('loading');
            document.getElementById('averageRatingCard').classList.add('loading');

            // 模拟API调用
            fetchAnalyticsData()
                .then(response => {
                    if (response.status === "success") {
                        // 移除加载状态
                        document.getElementById('positiveRateCard').classList.remove('loading');
                        document.getElementById('totalReviewsCard').classList.remove('loading');
                        document.getElementById('averageRatingCard').classList.remove('loading');

                        // 更新UI
                        updateAnalyticsUI(response.data);
                    }
                })
                .catch(error => {
                    console.error("API请求失败:", error);
                    // 错误处理，显示备用值
                    updateAnalyticsUI(mockData);

                    // 显示错误消息
                    alert('无法连接到数据服务器，显示缓存数据');
                });

            // 检测Windows系统并应用特定样式
            const isWindows = navigator.userAgent.includes('Windows');
            if (isWindows) {
                document.body.classList.add('windows-os');
            }
        });
    </script>
</body>

</html>